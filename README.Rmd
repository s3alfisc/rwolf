---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# rwolf

The `rwolf` package implements Romano-Wolf multiple-hypothesis-adjusted p-values for objects of type `fixest_multi` from the `fixest` package (currently for one-way clustered inference) via the pairs or wild cluster bootstrap. At its current stage, the package is highly experimental and it is not sufficiently tested.

## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("s3alfisc/rwolf")
```

## Example

As you can see in the example, there seems to be a bug in `rwolf()` for the pairs bootstrap.

```{r}
library(fixest)
library(rwolf)

set.seed(5)
N <- 1000
X1 <- rnorm(N)
X2 <- rnorm(N)
Y1 <- 1 + 1 * X1 + X2 + rnorm(N)
Y2 <- 1 + 0.01 * X1 + X2 + rnorm(N)
Y3 <- 1 + 0.01 * X1 + X2 + rnorm(N)
Y4 <- 1 + 0.01 * X1 + X2 + rnorm(N)

# intra-cluster correlation of 0 for all clusters
cluster <- rep(1:50, N / 50)

data <- data.frame(Y1 = Y1, 
                   Y2 = Y2, 
                   Y3 = Y3, 
                   Y4 = Y4,
                   X1 = X1,
                   X2 = X2,
                   cluster = cluster)

res <- feols(c(Y1, Y2, Y3, Y4) ~ X1 + X2, data = data, cluster = ~ cluster)

# adjust inference for null X1 = 0 vs X1 \neq 0
res_rwolf <- rwolf(models = res, parameter = "X1", B = 1000)
res_rwolf_wild <- rwolf(models = res, parameter = "X1", B = 1000, type = "wild")

summary(res_rwolf)
summary(res_rwolf_wild)


```

How does it compare to results from the `rwolf` Stata package? 

```{r}
library(RStata)
# initiate RStata
options("RStata.StataVersion" = 16)
options("RStata.StataPath" = "\"C:\\Program Files\\Stata16\\StataIC-64\"")
# save the data set so it can be loaded into STATA
data.table::fwrite(data, "c:/Users/alexa/Dropbox/rwolf/test.csv")

# estimate with stata via Rstata
stata_program <- "
clear 
set more off
import delimited c:/Users/alexa/Dropbox/rwolf/test.csv
set seed 1
rwolf y1 y2 y3 y4, vce(cluster cluster) cluster(cluster)  indepvar(x1) controls(x2) reps(1000) nodots
"
RStata::stata(stata_program, data.out = TRUE)
```

