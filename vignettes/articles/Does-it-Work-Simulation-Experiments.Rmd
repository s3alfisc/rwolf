---
title: "Does it Work? Simulation Experiments"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(wildrwolf)
```

To check if the `rwolf()` function (strongly) controls the family wise error rate, we conduct a range of simulation experiments. To do so, we simulate data after the following data generating process, following Clarke et al (2019).

## Experimental Design

We simulate $S = 10$ outcome variables following 

$$
  Y_{is} = 1 + \beta_{s} \times D_{i} + \epsilon_{is}
$$  

where $D_i$ is a binary variable equal to 0 or 1, and 

$$
  \epsilon_{is} = N(0_S, \Sigma)
$$ 

with $\Sigma$ being a covariance matrix with diagonal elements 1 and off-diagonal elements equal to $\rho$. In consequence, the higher the value of $\rho$, the higher the correlation between the simulated dependent variables.

We test S hypothesis of the form $H_0 = \beta_s = 0$ vs $H_0 \neq \beta_s = 0$ for all 
$s in 1, ..., S$. For all simulation draws, the null hypothesis is true, i.e. we set 
$\beta_s = 0$ for all values of $s$ when simulating the data. 

## Simulations 

The `run_fwer_sim()` function runs the experiments and computes the empirical family wise error rate as the fraction of test families with at least one rejected null hypothesis. We draw $S=10$ dependent variables for $N=100$ observations. The experiment is based on $B=1999$ bootstrap iterations and $n_sims = 1000$ iterations.

```{r, warning=FALSE, message= FALSE, eval = FALSE}
system.time(
    res <- run_fwer_sim(
      seed = 4567456,
      n_sims = 1000,
      B = 1999, 
      N = 100, 
      s = 10
    )
)
res
```


